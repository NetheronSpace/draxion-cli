# -*- coding: utf-8 -*-
import re

# Language settings
current_language = 'es'
translations = {
    'en': {
        "exit": "Exit",
        "back": "Back",
        "main_menu": "Main Menu",
        "login": "üîë Login",
        "register": "üë§ Register",
        "recover_key": "üîë Recover Key (SSS)",
        "change_language": "üîÑ Change Language",
        "select_option": "Select an option",
        "invalid_option": "* Invalid option, try again *",
        "press_enter": "¬ª Press Enter to continue...",
        "user_registration_title": "USER REGISTRATION",
        "user": "User",
        "server_not_responding": "Server is not responding.",
        "server_unavailable": "Error: Server unavailable",
        "user_unavailable": "User unavailable. Try another name.",
        "error_verifying_user": "Error verifying user",
        "verifying_user": "Verifying user...",
        "registering_user": "Registering user...",
        "account_password": "Account password (for recovery)",
        "confirm_account_password": "Confirm account password",
        "passwords_do_not_match": "Passwords do not match",
        "password_length_error": "Password must be at least 8 characters",
        "account_pin": "Account PIN (4 digits, for recovery)",
        "confirm_pin": "Confirm PIN",
        "pins_do_not_match": "PINs do not match",
        "pin_length_error": "PIN must be 4 digits",
        "registration_error": "Registration error",
        "account_registration_successful": "‚úì Account registration successful!",
        "private_key_password_title": "REGISTRATION - PRIVATE KEY PASSWORD",
        "private_key_password_info1": "This password encrypts your private key and will be your main credential.",
        "private_key_password_info2": "It is the only way to access your files. Do not forget it!",
        "key_password": "Password for the key (your new 'master password')",
        "confirm_key_password": "Confirm password for the key",
        "key_password_length_error": "The password for the key must be at least 12 characters",
        "private_key_saved": "‚úì Private key encrypted and saved in {KEY_FILE}",
        "private_key_save_warning": "WARNING: Could not save the private key.",
        "generating_zkp_signature": "Generating and saving ZKP signature on the server...",
        "zkp_signature_error": "Could not save the ZKP signature on the server.",
        "zkp_account_error": "Your account might not work. Contact support.",
        "zkp_generation_error": "Error generating the ZKP signature: {e}",
        "registration_complete": "‚úì Registration process completed.",
        "login_title": "LOGIN (ZKP)",
        "logging_in": "Logging in with the server...",
        "login_failed": "Could not log in",
        "private_key_password": "Private key password",
        "generating_zkp_proof": "Generating zero-knowledge proof...",
        "zkp_proof_generation_error": "Error generating the ZKP proof locally: {e}",
        "verifying_proof": "Verifying proof on the server...",
        "login_error": "Login error",
        "zkp_login_successful": "‚úì ZKP login successful!",
        "key_load_error": "Error: The key password is correct (ZKP login successful), but could not load the file {KEY_FILE}.",
        "welcome_banner": "WELCOME, {username}",
        "operations_menu": "Operations Menu",
        "file_management": "üìÅ File Management",
        "upload_files": "üì§ Upload Files",
        "key_rotation": "üîÑ Key Rotation",
        "audit_log": "üìù Audit Log",
        "split_key": "üîë Split Key (SSS)",
        "logout": "Logout",
        "languages": "üåê Languages",
        "language_menu_title": "CHANGE LANGUAGE",
        "select_language": "Select Language",
        "language_changed": "Language changed to English.",
        "operation_completed": "Operation completed",
        "operation_cancelled": "Operation cancelled.",
        "logging_out_message": "Logging out...",
        "exiting": "Exiting the system",
        "session_refreshed": "Session refreshed successfully.",
        "connection_error": "Connection error",
        "token_expired": "Token expired, trying to refresh...",
        "retry_connection_error": "Connection error on retry",
        "session_refresh_failed": "Could not refresh session. Please log in again.",
        "private_key_not_found": "Private key file not found",
        "private_key_decryption_error": "Error: Could not decrypt private key. The password might be incorrect.",
        "error_loading_private_key": "Error loading private key",
        "error_saving_key": "Error saving or encrypting key",
        "tkinter_not_available": "Error: Tkinter is not available for graphical selection.",
        "select_file_to_upload": "Select a file to upload",
        "file_path_prompt": "File path (TAB to autocomplete):",
        "file_not_found_try_again": "File not found, please try again",
        "must_be_logged_in_to_split_key": "Error: You must be logged in and have a private key loaded to split it.",
        "split_key_title": "SPLIT KEY (SHAMIR'S SECRET SHARING)",
        "split_key_info1": "This tool will split your private key into several shares.",
        "split_key_info2": "To recover the key, you will need a minimum number of these shares.",
        "split_key_warning": "Save each share in a safe and separate place!",
        "total_shares_prompt": "Total number of shares to create (e.g., 5)",
        "required_shares_prompt": "Minimum number of shares to recover (e.g., 3)",
        "k_greater_than_n_error": "Error: The minimum number of shares cannot be greater than the total.",
        "invalid_number_error": "Error: Please enter only integers.",
        "generating_n_shares": "Generating {n} shares",
        "error_splitting_key": "Error splitting the key",
        "key_split_successfully": "‚úì Key split successfully. Show the following shares and save them securely:",
        "share": "SHARE",
        "share_accepted": "Share accepted.",
        "save_shares_prompt": "Make sure you have saved all the shares before exiting.",
        "press_enter_to_return": "Press Enter to return to the menu",
        "recover_key_title": "RECOVER KEY (SHAMIR'S SECRET SHARING)",
        "key_file_exists_warning": "WARNING: A key file ({KEY_FILE}) already exists. \nDo you want to overwrite it?",
        "enter_shares_prompt": "Enter your key shares one by one. \nLeave a blank line to finish.",
        "recovering_key_with_n_shares": "Attempting to recover the key with {n} shares",
        "reconstructing_key": "Reconstructing key...",
        "error_recovering_key": "Error recovering the key. Make sure the shares are correct.",
        "key_recovered_successfully": "‚úì Key recovered successfully.",
        "create_new_password_for_key": "Now, create a new password to encrypt this key file on your disk.",
        "new_key_password": "New password for the key",
        "confirm_new_key_password": "Confirm the new password",
        "new_private_key_saved": "New private key encrypted and saved in {KEY_FILE}.",
        "you_can_login_now": "You can log in normally now.",
        "critical_error_saving_key": "CRITICAL ERROR: Could not save the recovered key.",
        "save_key_manually": "Please save the key manually in a safe place",
        "key_file_exists_info": "The private key file '{KEY_FILE}' already exists.",
        "sss_recovery_info": "SSS recovery is for when you have lost this file.",
        "upload_file_title": "UPLOAD FILE (WITH RESUMPTION)",
        "selection_method": "Selection Method",
        "graphical_window": "Graphical Window",
        "manual_path": "Manual Path",
        "cancel": "Cancel",
        "option": "Option",
        "file_not_selected_or_exists": "File not selected or does not exist.",
        "calculating_file_hash": "Calculating file hash",
        "error_signing_file": "Error signing file",
        "found_previous_upload": "Found a previous upload (ID: {upload_id})",
        "checking_status": "Checking status",
        "n_chunks_already_uploaded": "{n} chunks already uploaded",
        "resuming": "Resuming",
        "could_not_resume_upload": "Could not resume upload",
        "starting_new_one": "Starting a new one",
        "initiating_new_upload": "Initiating new upload",
        "could_not_initiate_upload": "Could not initiate upload",
        "new_upload_initiated_with_id": "New upload initiated with ID: {upload_id}",
        "progress": "Progress",
        "completed": "Completed",
        "error_uploading_chunk": "Error uploading chunk",
        "chunk_upload_failed": "Chunk upload failed",
        "upload_interrupted": "Upload was interrupted",
        "you_can_resume_later": "You can resume it later",
        "completing_upload": "Completing upload",
        "processing_file_on_server": "Processing file on server",
        "error_completing_upload": "Error completing upload",
        "file_uploaded_and_processed_successfully": "File uploaded and processed successfully",
        "error_getting_files": "Error getting files",
        "download_file_title": "DOWNLOAD FILE (WITH RESUMPTION)",
        "file": "File",
        "save_path_prompt": "Path to save (leave empty for original name)",
        "resuming_download_from": "Resuming download from {size} bytes",
        "error_during_download": "Error during download",
        "chunk_download_failed": "Chunk download failed",
        "download_interrupted": "Download was interrupted",
        "download_complete_decrypting": "Download complete. Decrypting file",
        "error_getting_decryption_key": "Error getting decryption key",
        "error_decrypting_file_key": "Error decrypting file key",
        "decrypting": "Decrypting...",
        "file_downloaded_and_decrypted_to": "File downloaded and decrypted to: {path}",
        "error_decrypting_file": "Error decrypting the file. The temporary file is kept in {path}",
        "share_file_title": "SHARE FILE",
        "user_id_to_share_with": "Username of the user to share with",
        "invalid_id": "Invalid ID",
        "sharing_file": "Sharing {file}",
        "file_shared_successfully": "File shared successfully",
        "error_sharing_file": "Error sharing file",
        "key_rotation_title": "ROTATE KEYS",
        "key_rotation_warning": "WARNING: This operation is critical. Make sure to save the new private key.",
        "cached_password_not_found": "Error: Cached key password not found. Try logging in again.",
        "rotating_security_keys": "Rotating security keys",
        "keys_rotated_successfully": "Keys rotated successfully",
        "new_public_key_saved_on_server": "New public key saved on server",
        "warning_could_not_save_new_private_key": "WARNING: Could not save the new private key",
        "error_rotating_keys": "Error rotating keys",
        "audit_log_title": "AUDIT LOG",
        "loading_events": "Loading events...",
        "error_getting_audit_log": "Error getting audit log",
        "no_audit_events": "No audit events to show.",
        "page": "Page",
        "press_enter_for_next_page": "Press Enter to see the next page, or type 's' to exit",
        "end_of_audit_log": "End of audit log.",
        "only_owner_can_delete": "Only the owner can delete the file",
        "delete_file_title": "DELETE FILE",
        "are_you_sure_you_want_to_delete": "Are you sure you want to delete '{file}'",
        "deleting_file": "Deleting {file}",
        "file_deleted_successfully": "File deleted successfully",
        "error_deleting_file": "Error deleting file",
        "file_management_title": "FILE MANAGEMENT",
        "no_files_available": "No files available.",
        "download_file": "Download file",
        "delete_file": "Delete file",
        "share_file": "Share file",
        "select_file_number": "Select the file number",
        "invalid_file_number": "Invalid file number",
        "invalid_input": "Invalid input",
        "thank_you_for_using": "Thank you for using Draxion Cloud",
        "session_closed_due_to_error": "Session closed due to a connection error.",
        "table_header_no": "No.",
        "table_header_file": "FILE",
        "table_header_size": "SIZE",
        "table_header_date": "DATE",
        "pending_shares": "üì¨ Pending Shares",
        "pending_shares_title": "PENDING SHARED FILES",
        "no_pending_shares": "No pending shares.",
        "accept": "Accept",
        "reject": "Reject",
        "from_user": "From",
        "file_name": "File",
        "date": "Date",
        "accept_reject_prompt": "Select an invitation number to (A)ccept or (R)eject (e.g., A 1), or 0 to go back",
        "username_cannot_be_empty": "Username cannot be empty",
        "file_browser": "üìÇ File Browser",
        "create_folder": "Create Folder",
        "parent_directory": "Parent Directory",
        "item_name": "Name",
        "item_type": "Type",
        "archivo": "File",
        "carpeta": "Folder",
        "enter_new_folder_name": "Enter new folder name",
        "enter_new_name": "Enter new name",
        "folder_created_successfully": "‚úì Folder created successfully",
        "item_renamed_successfully": "‚úì Item renamed successfully",
        "item_moved_successfully": "‚úì Item moved successfully",
        "folder_deleted_successfully": "‚úì Folder deleted successfully",
        "error_creating_folder": "Error creating folder",
        "error_renaming_item": "Error renaming item",
        "error_moving_item": "Error moving item",
        "error_deleting_folder": "Error deleting folder",
        "folder_not_empty": "Folder is not empty and cannot be deleted",
        "select_item_or_option": "Select an item number to manage, or an option",
        "open": "Open",
        "move": "Move",
        "rename": "Rename",
        "delete": "Delete",
        "select_destination_folder": "Select destination folder",
        "quit": "Quit",
        "go_back": "Go Back",
        "open_item": "Open",
        "rename_item": "Rename",
        "move_item": "Move",
        "delete_item": "Delete",
        "share_item": "Share",
        "enter_item_number_to_open": "Enter the number of the item to open",
        "enter_item_number_to_rename": "Enter the number of the item to rename",
        "enter_item_number_to_move": "Enter the number of the item to move",
        "enter_item_number_to_delete": "Enter the number of the item to delete",
        "enter_item_number_to_share": "Enter the number of the item to share",
        "cannot_share_folder": "You can only share files.",
        "are_you_sure_delete_folder": "Are you sure you want to delete the folder '{folder_name}'? (y/n): ",
        "plan": "Plan",
        "usage": "Usage",
        "of": "of",
        "unlimited": "Unlimited",
        "no_active_plan": "We are sorry, but you must select a plan to continue.",
        "file_browser_options": "OPTIONS: (O)PEN, (C)REATE FOLDER, (R)ENAME, (M)OVE, (D)ELETE, (S)HARE, (Q)UIT",
        "file_browser_options_concurrent": "OPTIONS: (O)PEN, (DA) DOWNLOAD ALL, (C)REATE FOLDER, (R)ENAME, (D)ELETE, (S)HARE, (..) BACK, (Q)UIT",
        "root_folder_option": "0. / (Root)",
        "parent_folder_option": ".. (Parent Directory)",
        "item_number_prompt": "¬ª Item number for action '{cmd}': ",
        "file_not_found_in_storage": "[Error: File not found in storage]",
        "verifying_files": "Verifying files...",
        "manage_accounts": "üë§ Manage Accounts",
        "manage_accounts_title": "MANAGE ACCOUNTS",
        "manage_accounts_menu": "Account Menu",
        "add_account": "Add New Account",
        "switch_account": "Switch Account",
        "logout_from_account": "Logout from Account",
        "no_profiles_found": "No profiles found. Please add an account.",
        "select_profile_to_switch": "Select a profile to switch to",
        "select_profile_to_logout": "Select a profile to logout from",
        "profile_switched": "Switched to profile: {username}",
        "profile_logged_out": "Logged out from profile: {username}",
        "reload": "Reload",
        "cannot_rename_shared": "Cannot rename shared files",
        "renaming_item": "Renaming item",
        "returning_to_menu": "Returning to main menu...",
        "selected_user_keys": "Selected user keys",
        "manage_shared_files": "üë• Manage Shared Files",
        "shared_files_title": "My Shared Files",
        "no_shared_files": "You have not shared any files.",
        "select_file_to_manage": "Select a file to manage access",
        "users_with_access_title": "Users with access to {file_name}",
        "no_users_with_access": "No other users have access to this file.",
        "select_user_to_revoke": "Select a user to revoke access",
        "revoke_access_confirm": "Are you sure you want to revoke access for {username} to {file_name}?",
        "access_revoked_successfully": "Access revoked successfully.",
        "error_revoking_access": "Error revoking access.",
        "accepted": "Accepted",
        "pending": "Pending",
        "unknown": "Unknown",
        "revoke_access": "Revoke Access",
        "confirm_remove_share_access": "Remove '{file_name}' from your view? (y/n): ",
        "removing_share_access": "Removing access...",
        "share_access_removed": "Access removed.",
        "error_removing_share_access": "Error removing access",
        "error_getting_shares": "Error getting the pending shared files",
        "accepting_share": "Accepting shared file...",
        "error_accepting_share": "Error accepting shared file",
        "rejecting_share": "Rejecting shared file...",
        "error_rejecting_share": "Error rejecting shared file",
        "trash": "üóëÔ∏è Trash",
        "trash_title": "TRASH",
        "loading_trash_items": "Loading trash items...",
        "error_loading_trash": "Error loading trash",
        "table_header_id": "ID",
        "deletion_date": "DELETION DATE",
        "trash_is_empty": "The trash is empty.",
        "trash_options": "OPTIONS: (R)ESTORE, (E)MPTY PERMANENTLY, (Q)UIT",
        "item_id_prompt": "¬ª Item ID for action '{cmd}': ",
        "invalid_file_id": "Invalid file ID",
        "restoring_file": "Restoring file...",
        "file_restored_successfully": "File restored successfully",
        "error_restoring_file": "Error restoring file",
        "are_you_sure_delete_permanently": "Are you sure you want to permanently delete this file? (y/n): ",
        "deleting_permanently": "Deleting permanently...",
        "file_deleted_permanently": "File deleted permanently",
        "error_deleting_permanently": "Error deleting file permanently",
        "delete_options_title": "DELETE OPTIONS",
        "move_to_trash": "Move to Trash (Default)",
        "delete_permanently": "Delete Permanently (Irreversible)",
        "select_delete_option": "Select an option",
        "are_you_sure_delete_permanently_confirm": "This action is IRREVERSIBLE. Type the word 'DELETE' to confirm: ",
        "file_moved_to_trash": "‚úì File moved to trash successfully.",
        "yes_char": "y",
        "delete_word": "DELETE",
        "upload_file": "Upload a single file",
        "upload_folder": "Upload a full folder",
        "from_cache": "from cache",
        "loading_from_server": "Loading from server (cache miss or expired)",
        "no_files_to_download_in_current_view": "No files to download in the current view.",
        "select_folder_to_save_files": "Select a folder to save the files",
        "invalid_directory_selected": "Invalid directory selected.",
        "starting_download_of_n_files": "Starting download of {n} files",
        "using_n_threads": "using {n} threads",
        "file_downloaded_successfully": "File '{file}' downloaded successfully",
        "file_download_failed": "Download of file '{file}' failed",
        "file_download_generated_exception": "Download of '{file}' generated an exception: {exc}",
        "download_summary": "Progress: {done}/{total} files downloaded.",
        "download_process_finished": "Download process finished.",
        "successful_downloads": "Successful downloads",
        "failed_downloads": "Failed downloads",
        "initiating_download": "Initiating download",
        "downloading": "Downloading",
        "download_failed": "Download failed",
        "starting_upload_of_n_files": "Starting upload of {n} files",
        "file_uploaded_successfully": "File '{file}' uploaded successfully",
        "file_upload_failed": "Upload of file '{file}' failed",
        "file_upload_generated_exception": "Upload of '{file}' generated an exception: {exc}",
        "upload_summary": "Progress: {done}/{total} files uploaded.",
        "upload_process_finished": "Upload process finished.",
        "successful_uploads": "Successful uploads",
        "failed_uploads": "Failed uploads",
        "invalid_path": "The selected path is not valid or does not exist.",
        "no_files_to_upload": "No files found to upload in the selected path.",
        "upload_phase_finished": "Upload phase finished",
        "processing_phase_started": "Server-side file processing has started...",
        "yes": "Yes",
        "no": "No",
        "name": "Name",
        "type": "Type",
        "size": "Size",
        "directory_updated": "Directory updated",
        "downloading_file": "Downloading file",
        "are_you_sure_delete_file": "Are you sure you want to delete '{file_name}'?",
        "create_folder_short": "New Folder",
        "rename_item_short": "Rename",
        "delete_item_short": "Delete",
        "share_item_short": "Share",
        "download_all_short": "Download All",
        "go_back_short": "Back",
        "refresh_short": "Refresh",
        "quit_short": "Quit"
    },
    'es': {
        "exit": "Salir",
        "back": "Volver",
        "main_menu": "Men√∫ Principal",
        "login": "üîë Iniciar Sesi√≥n",
        "register": "üë§ Registrarse",
        "recover_key": "üîë Recuperar Clave (SSS)",
        "change_language": "üîÑ Cambiar Idioma",
        "select_option": "Seleccione una opci√≥n",
        "invalid_option": "* Opci√≥n inv√°lida, intente nuevamente *",
        "press_enter": "¬ª Presione Enter para continuar...",
        "user_registration_title": "REGISTRO DE USUARIO",
        "user": "Usuario",
        "server_not_responding": "El servidor no responde.",
        "server_unavailable": "Error: Servidor no disponible",
        "user_unavailable": "Usuario no disponible. Intente con otro nombre.",
        "error_verifying_user": "Error verificando usuario",
        "verifying_user": "Verificando usuario...",
        "registering_user": "Registrando usuario...",
        "account_password": "Contrase√±a de cuenta (para recuperaci√≥n)",
        "confirm_account_password": "Confirme contrase√±a de cuenta",
        "passwords_do_not_match": "Las contrase√±as no coinciden",
        "password_length_error": "La contrase√±a debe tener al menos 8 caracteres",
        "account_pin": "PIN de cuenta (4 d√≠gitos, para recuperaci√≥n)",
        "confirm_pin": "Confirme PIN",
        "pins_do_not_match": "Los PINs no coinciden",
        "pin_length_error": "PIN debe ser de 4 d√≠gitos",
        "registration_error": "Error en registro",
        "account_registration_successful": "‚úì Registro de cuenta exitoso!",
        "private_key_password_title": "REGISTRO - CONTRASE√ëA DE CLAVE PRIVADA",
        "private_key_password_info1": "Esta contrase√±a cifra su clave privada y ser√° su credencial principal.",
        "private_key_password_info2": "Es la √∫nica forma de acceder a sus archivos. ¬°No la olvide!",
        "key_password": "Contrase√±a para la clave (su nueva 'master password')",
        "confirm_key_password": "Confirme contrase√±a para la clave",
        "key_password_length_error": "La contrase√±a para la clave debe tener al menos 12 caracteres",
        "private_key_saved": "‚úì Clave privada cifrada y guardada en {KEY_FILE}",
        "private_key_save_warning": "ADVERTENCIA: No se pudo guardar la clave privada.",
        "generating_zkp_signature": "Generando y guardando firma ZKP en el servidor...",
        "zkp_signature_error": "No se pudo guardar la firma ZKP en el servidor.",
        "zkp_account_error": "Su cuenta podr√≠a no funcionar. Contacte a soporte.",
        "zkp_generation_error": "Error generando la firma ZKP: {e}",
        "registration_complete": "‚úì Proceso de registro completado.",
        "login_title": "INICIO DE SESI√ìN (ZKP)",
        "logging_in": "Iniciando sesi√≥n con el servidor...",
        "login_failed": "No se pudo iniciar sesi√≥n",
        "private_key_password": "Contrase√±a de la clave privada",
        "generating_zkp_proof": "Generando prueba de conocimiento cero...",
        "zkp_proof_generation_error": "Error al generar la prueba ZKP localmente: {e}",
        "verifying_proof": "Verificando prueba en el servidor...",
        "login_error": "Error en inicio de sesi√≥n",
        "zkp_login_successful": "‚úì Inicio de sesi√≥n ZKP exitoso!",
        "key_load_error": "Error: La contrase√±a de la clave es correcta (login ZKP exitoso), pero no se pudo cargar el archivo {KEY_FILE}.",
        "welcome_banner": "BIENVENIDO, {username}",
        "operations_menu": "Men√∫ de Operaciones",
        "file_management": "üìÅ Gesti√≥n de Archivos",
        "upload_files": "üì§ Subir Archivos",
        "key_rotation": "üîÑ Rotaci√≥n de Claves",
        "audit_log": "üìù Registro de Auditor√≠a",
        "split_key": "üîë Dividir Clave (SSS)",
        "logout": "Cerrar Sesi√≥n",
        "languages": "üåê Idiomas",
        "language_menu_title": "CAMBIAR IDIOMA",
        "select_language": "Seleccionar Idioma",
        "language_changed": "Idioma cambiado a Espa√±ol.",
        "operation_completed": "Operaci√≥n completada",
        "operation_cancelled": "Operaci√≥n cancelada.",
        "logging_out_message": "Cerrando sesi√≥n...",
        "exiting": "Saliendo del sistema",
        "session_refreshed": "Sesi√≥n refrescada exitosamente.",
        "connection_error": "Error de conexi√≥n",
        "token_expired": "Token expirado, intentando refrescar...",
        "retry_connection_error": "Error de conexi√≥n en reintento",
        "session_refresh_failed": "No se pudo refrescar la sesi√≥n. Por favor, inicie sesi√≥n de nuevo.",
        "private_key_not_found": "Archivo de clave privada no encontrado",
        "private_key_decryption_error": "Error: No se pudo descifrar la clave privada. La contrase√±a podr√≠a ser incorrecta.",
        "error_loading_private_key": "Error cargando clave privada",
        "error_saving_key": "Error guardando o cifrando clave",
        "tkinter_not_available": "Error: Tkinter no est√° disponible para la selecci√≥n gr√°fica.",
        "select_file_to_upload": "Seleccione un archivo para subir",
        "file_path_prompt": "Ruta del archivo (TAB para autocompletar)",
        "file_not_found_try_again": "Archivo no encontrado, intenta nuevamente",
        "must_be_logged_in_to_split_key": "Error: Debes iniciar sesi√≥n y tener una clave privada cargada para poder dividirla.",
        "split_key_title": "DIVIDIR CLAVE (SHAMIR'S SECRET SHARING)",
        "split_key_info1": "Esta herramienta dividir√° tu clave privada en varios fragmentos (shares).",
        "split_key_info2": "Para recuperar la clave, necesitar√°s un n√∫mero m√≠nimo de estos fragmentos.",
        "split_key_warning": "¬°Guarda cada fragmento en un lugar seguro y separado!",
        "total_shares_prompt": "N√∫mero total de fragmentos a crear (ej. 5)",
        "required_shares_prompt": "N√∫mero m√≠nimo de fragmentos para recuperar (ej. 3)",
        "k_greater_than_n_error": "Error: El n√∫mero m√≠nimo de fragmentos no puede ser mayor que el total.",
        "invalid_number_error": "Error: Introduce solo n√∫meros enteros.",
        "generating_n_shares": "Generando {n} fragmentos",
        "error_splitting_key": "Error al dividir la clave",
        "key_split_successfully": "‚úì Clave dividida exitosamente. Muestra los siguientes fragmentos y gu√°rdalos de forma segura:",
        "share": "Compartir",
        "share_accepted": "Fragmento aceptado.",
        "save_shares_prompt": "Aseg√∫rate de haber guardado todos los fragmentos antes de salir.",
        "press_enter_to_return": "Presione Enter para volver al men√∫",
        "recover_key_title": "RECUPERAR CLAVE (SHAMIR'S SECRET SHARING)",
        "key_file_exists_warning": "ADVERTENCIA: Ya existe un archivo de clave ({KEY_FILE}). \n¬øDeseas sobrescribirlo?",
        "enter_shares_prompt": "Introduce los fragmentos de tu clave uno por uno. \nDeja una l√≠nea en blanco para finalizar.",
        "recovering_key_with_n_shares": "Intentando recuperar la clave con {n} fragmentos",
        "reconstructing_key": "Reconstruyendo clave...",
        "error_recovering_key": "Error al recuperar la clave. Aseg√∫rate de que los fragmentos son correctos.",
        "key_recovered_successfully": "‚úì Clave recuperada exitosamente.",
        "create_new_password_for_key": "Ahora, crea una nueva contrase√±a para cifrar este archivo de clave en tu disco.",
        "new_key_password": "Nueva contrase√±a para la clave",
        "confirm_new_key_password": "Confirme la nueva contrase√±a",
        "new_private_key_saved": "Nueva clave privada cifrada y guardada en {KEY_FILE}.",
        "you_can_login_now": "Puedes iniciar sesi√≥n normalmente ahora.",
        "critical_error_saving_key": "ERROR CR√çTICO: No se pudo guardar la clave recuperada.",
        "save_key_manually": "Por favor, guarda la clave manualmente en un lugar seguro",
        "key_file_exists_info": "El archivo de clave privada '{KEY_FILE}' ya existe.",
        "sss_recovery_info": "La recuperaci√≥n SSS es para cuando has perdido este archivo.",
        "upload_file_title": "SUBIR ARCHIVO (CON REANUDACI√ìN)",
        "selection_method": "M√©todo de Selecci√≥n",
        "graphical_window": "Ventana Gr√°fica",
        "manual_path": "Ruta Manual",
        "cancel": "Cancelar",
        "option": "Opci√≥n",
        "file_not_selected_or_exists": "Archivo no seleccionado o no existe.",
        "calculating_file_hash": "Calculando hash del archivo",
        "error_signing_file": "Error al firmar archivo",
        "found_previous_upload": "Se encontr√≥ una subida previa (ID: {upload_id})",
        "checking_status": "Verificando estado",
        "n_chunks_already_uploaded": "{n} chunks ya subidos",
        "resuming": "Reanudando",
        "could_not_resume_upload": "No se pudo reanudar la subida",
        "starting_new_one": "Iniciando una nueva",
        "initiating_new_upload": "Iniciando nueva subida",
        "could_not_initiate_upload": "No se pudo iniciar la subida",
        "new_upload_initiated_with_id": "Subida nueva iniciada con ID: {upload_id}",
        "progress": "Progreso",
        "completed": "Completado",
        "error_uploading_chunk": "Error al subir el chunk",
        "chunk_upload_failed": "Fallo en la subida de un chunk",
        "upload_interrupted": "La subida fue interrumpida",
        "you_can_resume_later": "Puede reanudarla m√°s tarde",
        "completing_upload": "Completando subida",
        "processing_file_on_server": "Procesando archivo en el servidor",
        "error_completing_upload": "Error al completar la subida",
        "file_uploaded_and_processed_successfully": "Archivo subido y procesado exitosamente",
        "error_getting_files": "Error al obtener archivos",
        "download_file_title": "DESCARGAR ARCHIVO (CON REANUDACI√ìN)",
        "file": "Archivo",
        "save_path_prompt": "Ruta para guardar (dejar vac√≠o para nombre original)",
        "resuming_download_from": "Reanudando descarga desde {size} bytes",
        "error_during_download": "Error durante la descarga",
        "chunk_download_failed": "Fallo en la descarga de un chunk",
        "download_interrupted": "La descarga fue interrumpida",
        "download_complete_decrypting": "Descarga completa. Descifrando archivo",
        "error_getting_decryption_key": "Error al obtener la clave de descifrado",
        "error_decrypting_file_key": "Error al descifrar la clave del archivo",
        "decrypting": "Descifrando...",
        "file_downloaded_and_decrypted_to": "Archivo descargado y descifrado en: {path}",
        "error_decrypting_file": "Error al descifrar el archivo. El archivo temporal se conserva en {path}",
        "share_file_title": "COMPARTIR ARCHIVO",
        "user_id_to_share_with": "Nombre de usuario con quien compartir",
        "invalid_id": "ID inv√°lido",
        "sharing_file": "Compartiendo {file}",
        "file_shared_successfully": "Archivo compartido exitosamente",
        "error_sharing_file": "Error al compartir archivo",
        "key_rotation_title": "ROTAR CLAVES",
        "key_rotation_warning": "ADVERTENCIA: Esta operaci√≥n es cr√≠tica. Aseg√∫rate de guardar la nueva clave privada.",
        "cached_password_not_found": "Error: No se encontr√≥ la contrase√±a de la clave en cach√©. Intente reiniciar sesi√≥n.",
        "rotating_security_keys": "Rotando claves de seguridad",
        "keys_rotated_successfully": "Claves rotadas exitosamente",
        "new_public_key_saved_on_server": "Nueva clave p√∫blica guardada en servidor",
        "warning_could_not_save_new_private_key": "ADVERTENCIA: No se pudo guardar la nueva clave privada",
        "error_rotating_keys": "Error al rotar claves",
        "audit_log_title": "REGISTRO DE AUDITOR√çA",
        "loading_events": "Cargando eventos...",
        "error_getting_audit_log": "Error al obtener auditor√≠a",
        "no_audit_events": "No hay eventos de auditor√≠a para mostrar.",
        "page": "P√°gina",
        "press_enter_for_next_page": "Presione Enter para ver la p√°gina siguiente, o escriba 's' para salir",
        "end_of_audit_log": "Fin del registro de auditor√≠a.",
        "only_owner_can_delete": "Solo el propietario puede eliminar el archivo",
        "delete_file_title": "ELIMINAR ARCHIVO",
        "are_you_sure_you_want_to_delete": "¬øEst√°s seguro de eliminar '{file}'",
        "deleting_file": "Eliminando {file}",
        "file_deleted_successfully": "Archivo eliminado exitosamente",
        "error_deleting_file": "Error al eliminar archivo",
        "file_management_title": "GESTI√ìN DE ARCHIVOS",
        "no_files_available": "No hay archivos disponibles.",
        "download_file": "Descargar archivo",
        "delete_file": "Eliminar archivo",
        "share_file": "Compartir archivo",
        "select_file_number": "Seleccione el n√∫mero de archivo",
        "invalid_file_number": "N√∫mero de archivo inv√°lido",
        "invalid_input": "Entrada inv√°lida",
        "thank_you_for_using": "Gracias por usar Draxion Cloud",
        "session_closed_due_to_error": "Sesi√≥n cerrada por un error de conexi√≥n.",
        "table_header_no": "No.",
        "table_header_file": "ARCHIVO",
        "table_header_size": "TAMA√ëO",
        "table_header_date": "FECHA",
        "pending_shares": "üì¨ Archivos Pendientes",
        "pending_shares_title": "ARCHIVOS COMPARTIDOS PENDIENTES",
        "no_pending_shares": "No hay archivos compartidos pendientes.",
        "accept": "Aceptar",
        "reject": "Rechazar",
        "from_user": "De",
        "file_name": "Archivo",
        "date": "Fecha",
        "accept_reject_prompt": "Seleccione una invitaci√≥n para (A)ceptar o (R)echazar (ej. A 1), o 0 para volver",
        "username_cannot_be_empty": "El nombre de usuario no puede estar vac√≠o",
        "file_browser": "üìÇ Explorador de Archivos",
        "create_folder": "Crear Carpeta",
        "parent_directory": "Directorio Superior",
        "item_name": "Nombre",
        "item_type": "Tipo",
        "archivo": "Archivo",
        "carpeta": "Carpeta",
        "enter_new_folder_name": "Introduce el nombre de la nueva carpeta",
        "enter_new_name": "Introduce el nuevo nombre",
        "folder_created_successfully": "‚úì Carpeta creada con √©xito",
        "item_renamed_successfully": "‚úì Elemento renombrado con √©xito",
        "item_moved_successfully": "‚úì Elemento movido con √©xito",
        "folder_deleted_successfully": "‚úì Carpeta eliminada con √©xito",
        "error_creating_folder": "Error al crear la carpeta",
        "error_renaming_item": "Error al renombrar el elemento",
        "error_moving_item": "Error al mover el elemento",
        "error_deleting_folder": "Error al eliminar la carpeta",
        "folder_not_empty": "La carpeta no est√° vac√≠a y no se puede eliminar",
        "select_item_or_option": "Selecciona un n√∫mero de elemento para gestionar, o una opci√≥n",
        "open": "Abrir",
        "move": "Mover",
        "rename": "Renombrar",
        "delete": "Eliminar",
        "select_destination_folder": "Selecciona la carpeta de destino",
        "quit": "Salir",
        "go_back": "Volver",
        "open_item": "Abrir",
        "rename_item": "Renombrar",
        "move_item": "Mover",
        "delete_item": "Eliminar",
        "share_item": "Compartir",
        "enter_item_number_to_open": "Introduce el n√∫mero del elemento para abrir",
        "enter_item_number_to_rename": "Introduce el n√∫mero del elemento para renombrar",
        "enter_item_number_to_move": "Introduce el n√∫mero del elemento para mover",
        "enter_item_number_to_delete": "Introduce el n√∫mero del elemento para eliminar",
        "enter_item_number_to_share": "Introduce el n√∫mero del elemento para compartir",
        "cannot_share_folder": "Solo puedes compartir archivos.",
        "are_you_sure_delete_folder": "¬øEst√°s seguro de que quieres eliminar la carpeta '{folder_name}'? (s/n): ",
        "plan": "Plan",
        "usage": "Uso",
        "of": "de",
        "unlimited": "Ilimitado",
        "no_active_plan": "Lo sentimos, pero debe seleccionar alg√∫n plan para continuar.",
        "file_browser_options": "OPCIONES: (O)ABRIR, (C)REAR CARPETA, (R)ENOMBRAR, (M)OVER, (D)ELIMINAR, (S)COMPARTIR, (Q)SALIR",
        "file_browser_options_concurrent": "OPCIONES: (O)ABRIR, (DA) DESCARGAR TODO, (C)REAR CARPETA, (R)ENOMBRAR, (D)ELIMINAR, (S)COMPARTIR, (..) VOLVER, (Q)SALIR",
        "root_folder_option": "0. / (Ra√≠z)",
        "parent_folder_option": ".. (Directorio Superior)",
        "item_number_prompt": "¬ª N√∫mero de elemento para la acci√≥n '{cmd}': ",
        "file_not_found_in_storage": "[Error: Archivo no encontrado en almacenamiento]",
        "verifying_files": "Verificando archivos...",
        "manage_accounts": "üë§ Gestionar Cuentas",
        "manage_accounts_title": "GESTIONAR CUENTAS",
        "manage_accounts_menu": "Men√∫ de Cuentas",
        "add_account": "A√±adir Nueva Cuenta",
        "switch_account": "Cambiar de Cuenta",
        "logout_from_account": "Cerrar Sesi√≥n de Cuenta",
        "no_profiles_found": "No se encontraron perfiles. Por favor, a√±ada una cuenta.",
        "select_profile_to_switch": "Seleccione un perfil al que cambiar",
        "select_profile_to_logout": "Seleccione un perfil del que cerrar sesi√≥n",
        "profile_switched": "Cambiado al perfil: {username}",
        "profile_logged_out": "Sesi√≥n cerrada del perfil: {username}",
        "reload": "Recargar",
        "cannot_rename_shared": "No se puede renombrar archivos compartidos",
        "renaming_item": "Renombrando elemento",
        "returning_to_menu": "Volviendo al men√∫ principal...",
        "selected_user_keys": "Claves seleccionadas del usuario",
        "manage_shared_files": "üë• Gestionar Archivos Compartidos",
        "shared_files_title": "Mis Archivos Compartidos",
        "no_shared_files": "No has compartido ning√∫n archivo.",
        "select_file_to_manage": "Selecciona un archivo para gestionar accesos",
        "users_with_access_title": "Usuarios con acceso a {file_name}",
        "no_users_with_access": "Ning√∫n otro usuario tiene acceso a este archivo.",
        "select_user_to_revoke": "Selecciona un usuario para revocar el acceso",
        "revoke_access_confirm": "¬øEst√°s seguro de que quieres revocar el acceso de {username} a {file_name}?",
        "access_revoked_successfully": "Acceso revocado exitosamente.",
        "error_revoking_access": "Error al revocar el acceso.",
        "accepted": "Aceptado",
        "pending": "Pendiente",
        "unknown": "Desconocido",
        "revoke_access": "Revocar Acceso",
        "confirm_remove_share_access": "¬øQuitar '{file_name}' de tu vista? (s/n): ",
        "removing_share_access": "Eliminando acceso...",
        "share_access_removed": "Acceso eliminado.",
        "error_removing_share_access": "Error al eliminar el acceso",
        "error_getting_shares": "Error al obtener los archivos compartidos pendientes",
        "accepting_share": "Aceptando archivo compartido...",
        "error_accepting_share": "Error al aceptar el archivo compartido",
        "rejecting_share": "Rechazando archivo compartido...",
        "error_rejecting_share": "Error al rechazar el archivo compartido",
        "trash": "üóëÔ∏è Papelera",
        "trash_title": "PAPELERA DE RECICLAJE",
        "loading_trash_items": "Cargando elementos de la papelera...",
        "error_loading_trash": "Error al cargar la papelera",
        "table_header_id": "ID",
        "deletion_date": "FECHA DE ELIMINACI√ìN",
        "trash_is_empty": "La papelera est√° vac√≠a.",
        "trash_options": "OPCIONES: (R)ESTAURAR, (E)LIMINAR PERMANENTEMENTE, (Q)SALIR",
        "item_id_prompt": "¬ª ID del elemento para la acci√≥n '{cmd}': ",
        "invalid_file_id": "ID de archivo inv√°lido",
        "restoring_file": "Restaurando archivo...",
        "file_restored_successfully": "Archivo restaurado con √©xito",
        "error_restoring_file": "Error al restaurar el archivo",
        "are_you_sure_delete_permanently": "¬øEst√°s seguro de eliminar permanentemente este archivo? (s/n): ",
        "deleting_permanently": "Eliminando permanentemente...",
        "file_deleted_permanently": "Archivo eliminado permanentemente",
        "error_deleting_permanently": "Error al eliminar el archivo permanentemente",
        "delete_options_title": "OPCIONES DE ELIMINACI√ìN",
        "move_to_trash": "Mover a la Papelera (Por defecto)",
        "delete_permanently": "Eliminar Permanentemente (Irreversible)",
        "select_delete_option": "Seleccione una opci√≥n",
        "are_you_sure_delete_permanently_confirm": "Esta acci√≥n es IRREVERSIBLE. Escriba la palabra 'ELIMINAR' para confirmar: ",
        "file_moved_to_trash": "‚úì Archivo movido a la papelera con √©xito.",
        "yes_char": "s",
        "delete_word": "ELIMINAR",
        "upload_file": "Subir un solo archivo",
        "upload_folder": "Subir una carpeta completa",
        "from_cache": "desde cach√©",
        "loading_from_server": "Cargando desde el servidor (cach√© ausente o expirado)",
        "no_files_to_download_in_current_view": "No hay archivos para descargar en la vista actual.",
        "select_folder_to_save_files": "Seleccione una carpeta para guardar los archivos",
        "invalid_directory_selected": "Directorio seleccionado no v√°lido.",
        "starting_download_of_n_files": "Iniciando descarga de {n} archivos",
        "using_n_threads": "usando {n} hilos",
        "file_downloaded_successfully": "Archivo '{file}' descargado con √©xito",
        "file_download_failed": "La descarga del archivo '{file}' fall√≥",
        "file_download_generated_exception": "La descarga de '{file}' gener√≥ una excepci√≥n: {exc}",
        "download_summary": "Progreso: {done}/{total} archivos descargados.",
        "download_process_finished": "Proceso de descarga finalizado.",
        "successful_downloads": "Descargas exitosas",
        "failed_downloads": "Descargas fallidas",
        "initiating_download": "Iniciando descarga",
        "downloading": "Descargando",
        "download_failed": "La descarga fall√≥",
        "starting_upload_of_n_files": "Iniciando subida de {n} archivos",
        "file_uploaded_successfully": "Archivo '{file}' subido con √©xito",
        "file_upload_failed": "La subida del archivo '{file}' fall√≥",
        "file_upload_generated_exception": "La subida de '{file}' gener√≥ una excepci√≥n: {exc}",
        "upload_summary": "Progreso: {done}/{total} archivos subidos.",
        "upload_process_finished": "Proceso de subida finalizado.",
        "successful_uploads": "Subidas exitosas",
        "failed_uploads": "Subidas fallidas",
        "invalid_path": "La ruta seleccionada no es v√°lida o no existe.",
        "no_files_to_upload": "No se encontraron archivos para subir en la ruta seleccionada.",
        "upload_phase_finished": "Fase de subida terminada",
        "processing_phase_started": "Iniciando procesamiento de archivos en el servidor...",
        "yes": "S√≠",
        "no": "No",
        "name": "Nombre",
        "type": "Tipo",
        "size": "Tama√±o",
        "directory_updated": "Directorio actualizado",
        "downloading_file": "Descargando archivo",
        "are_you_sure_delete_file": "¬øEst√°s seguro de que quieres eliminar '{file_name}'?",
        "create_folder_short": "Nueva Carpeta",
        "rename_item_short": "Renombrar",
        "delete_item_short": "Eliminar",
        "share_item_short": "Compartir",
        "download_all_short": "Descargar Todo",
        "go_back_short": "Volver",
        "refresh_short": "Recargar",
        "quit_short": "Salir"
    }
}

from .config import load_client_config, save_client_config

def set_language(lang):
    """
    Establece el idioma actual para la sesi√≥n y lo guarda en la configuraci√≥n.
    """
    global current_language
    if lang in translations:
        current_language = lang
        try:
            config = load_client_config()
            config['language'] = lang
            save_client_config(config)
        except Exception:
            # Si falla el guardado, la aplicaci√≥n no debe romperse.
            # El idioma se cambiar√° para la sesi√≥n actual de todas formas.
            pass
        return True
    return False

def t(key, **kwargs):
    # This is a simplified t function for the example. 
    # A real implementation might handle nested keys, pluralization, etc.
    if '|' in key:
        try:
            base_key, extra = key.split('|', 1)
            base_text = translations[current_language].get(base_key, base_key)
            return f"{base_text} ({extra})"
        except (ValueError, IndexError):
            # Fallback if the split fails unexpectedly
            pass
    return translations[current_language].get(key, key).format(**kwargs)